<%- include('../partials/header.ejs') %>

  <main id="show-post">
    <div id="total-post">
      <article id="postId">
        <%= post.postText %>
          <div id="avatar">
            <a href="/users/<%= user._id %>"><img src="<%= post.userAvatar %>" alt="avatar"
                referrerpolicy="no-referer">&nbsp;</a>
          </div>
      </article>
      <article id="post-nav-show">
        <% if (user?._id.toString()===(post.user.toString())) { %>
          <form action="/posts/<%= post._id %>?_method=DELETE" class="delete-post" method="POST"><button
              type="submit">Delete</button></form>
          <% } %>
      </article>
    </div>
  </main>
  <% if(post.replies) { %>
    <section id="replies-populated">
      <br>
      <% post.replies.forEach((r)=> { %>
        <article id="reply-post">
          <div id="reply-delete">
            <div>
              <%= r.replyText %>
            </div>
            <div>
              <% if(r.user.toString()===user?._id.toString()) { %>
                <form action="/replies/<%= r._id  %>?_method=DELETE" class="delete-post" method="POST">
                  <button type="submit">Delete</button>
                </form>
                <% } %>
            </div>
          </div>
          <div id="avatar-reply">
            <img src="<%= r.userAvatar %>" alt="avatar">
          </div>
        </article>
        <% }) %>
          <br>
    </section>
    <% } %>
      <section id="reply-box">
        <form action="/posts/<%= post._id %>/replies" method="POST">
          <input type="text" name="replyText" id="post-text" placeholder="Got something to say?">
        </form>
      </section>

      <%- include('../partials/footer.ejs') %>